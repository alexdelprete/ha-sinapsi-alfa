# v1.2.7

[![GitHub Downloads](https://img.shields.io/github/downloads/alexdelprete/ha-sinapsi-alfa/v1.2.7/total?style=for-the-badge)](https://github.com/alexdelprete/ha-sinapsi-alfa/releases/tag/v1.2.7)

**Release Date:** January 16, 2026

**Patch release** - Adds Modbus integration conflict detection to prevent connection issues.

## What's Changed

### New Features

- **Modbus conflict detection at setup** - The integration now detects if Home
  Assistant's built-in Modbus integration is already configured for the same
  device and blocks setup with a clear error message

- **Runtime conflict detection** - If the Modbus integration is added after
  this integration is set up, a repair issue is created to alert you

- **IP vs hostname resolution** - Conflict detection properly compares IP
  addresses even when one config uses IP and another uses hostname (e.g.,
  `192.168.1.100` vs `alfa.local`)

### Why This Matters

The Sinapsi Alfa device only supports **one Modbus TCP client at a time**.
Many users have the Sinapsi-provided YAML package
(`alfa-ha-modbus-configuration.yaml`) installed, which uses Home Assistant's
built-in Modbus integration. When both integrations try to connect, it causes
connection failures.

This release automatically detects and prevents this common configuration
issue.

### Documentation

- **README updated** - Added "Important: Modbus Integration Conflict" section
  with clear instructions before installation
- **Translations** - Added conflict messages in all 10 supported languages
  (de, en, es, et, fi, fr, it, nb, pt, sv)

### Testing

- **98% test coverage** - Added comprehensive tests for conflict detection
- **24 new tests** - Cover all conflict detection scenarios

## Technical Details

### Files Changed

| File | Changes |
|------|---------|
| `helpers.py` | Added `resolve_host_to_ip()` and `check_modbus_conflict()` |
| `config_flow.py` | Added conflict check in user and reconfigure steps |
| `coordinator.py` | Added runtime conflict detection in `async_update_data()` |
| `repairs.py` | Added `create_modbus_conflict_issue()` and `delete_modbus_conflict_issue()` |
| `README.md` | Added Modbus conflict warning section |
| `translations/*.json` | Added conflict abort and repair issue translations |

### How Conflict Detection Works

1. **At setup**: Before connecting, the integration checks if any Modbus
   config entries point to the same IP address
2. **At runtime**: During each data update, if a new Modbus conflict is
   detected, a repair issue is created
3. **IP resolution**: Both IP addresses and hostnames are resolved to compare
   actual IP addresses

## Full Changelog

**Full Changelog:** [v1.2.6...v1.2.7](https://github.com/alexdelprete/ha-sinapsi-alfa/compare/v1.2.6...v1.2.7)
