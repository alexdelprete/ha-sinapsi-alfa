# Release Notes - v1.0.0

**Release Date**: 2025-12-07
**Type**: Official Release (Stable)
**Status**: Production Ready

## Overview

Major release featuring migration to ModbusLink library with **7x performance improvement** in data collection.

## What's New

### ModbusLink Migration

Replaced pymodbus with [ModbusLink](https://github.com/Miraitowa-la/ModbusLink) library:

- **Modern async API** - Native asyncio with context manager support
- **Cleaner codebase** - Removed 663 lines of deprecated pymodbus payload decoder code
- **Direct register access** - `read_holding_registers()` returns `List[int]` directly
- **Built-in error handling** - Structured exceptions for connection, timeout, and protocol errors

### Performance Improvements

| Metric | v0.5.0 (pymodbus) | v1.0.0 (ModbusLink) | Improvement |
|--------|-------------------|---------------------|-------------|
| Data collection time | ~3.8s | ~0.5s | **7x faster** |
| Modbus requests per cycle | 20 | 5 | **75% fewer** |

**How it works:**

- **Batch register reads** - 5 batches instead of 20 individual reads
- **Sequential batch processing** - Optimized for Modbus TCP protocol
- **Context manager** - Automatic connection handling

### Bug Fixes

- **Fixed IPv4/IPv6 connection timeout** - Forces IPv4 (`socket.AF_INET`) to avoid dual-stack timeouts when device only supports IPv4
- **Fixed Transaction ID mismatch** - Sequential batch reads prevent Modbus TCP protocol violations

### Code Quality

- **Enhanced debug logging** - Sensor values logged during data collection
- **Layered error handling** - Retry transient errors, fail fast on protocol errors
- **Dynamic sensor mapping** - `SENSOR_MAP` built automatically from `SENSOR_ENTITIES`

## Breaking Changes

- **Requires ModbusLink >= 1.2.0** - pymodbus is no longer used
- Removed deprecated files: `pymodbus_constants.py`, `pymodbus_payload.py`

## Requirements

- Home Assistant 2025.10.0 or newer
- Python 3.13.2 or newer (managed by Home Assistant)

## Files Changed

| File | Changes |
|------|---------|
| `api.py` | Complete rewrite using ModbusLink, batch reads, enhanced logging |
| `const.py` | Added `REGISTER_BATCHES` configuration |
| `manifest.json` | Changed dependency from pymodbus to modbuslink |

## Migration from v0.5.0

No user action required. The integration will automatically use the new ModbusLink library after updating.

## Beta Testing History

This release incorporates fixes from the beta testing cycle:

- **v1.0.0-beta.1** - Initial ModbusLink migration
- **v1.0.0-beta.2** - Batch reads and parallel processing (later revised)
- **v1.0.0-beta.3** - IPv4 connection fix
- **v1.0.0-beta.4** - Sequential batch reads fix

---

**Full Changelog**: [v0.5.0...v1.0.0](https://github.com/alexdelprete/ha-sinapsi-alfa/compare/v0.5.0...v1.0.0)
